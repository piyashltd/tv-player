<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BongoStream | Premium Bengali TV</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        brand: '#e50914',
                        dark: '#141414',
                        darker: '#0b0b0b',
                        card: '#1e1e1e'
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    }
                }
            }
        }
    </script>

    <!-- Fonts & Icons -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/@phosphor-icons/web"></script>

    <!-- Video.js -->
    <link href="https://vjs.zencdn.net/8.6.1/video-js.css" rel="stylesheet" />

    <!-- Swiper -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />

    <style>
        body { font-family: 'Inter', sans-serif; }
        /* Hide Scrollbar but allow scroll */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* Skeleton Loading Animation */
        @keyframes shimmer {
            0% { background-position: -1000px 0; }
            100% { background-position: 1000px 0; }
        }
        .skeleton {
            animation: shimmer 2s infinite linear;
            background: linear-gradient(to right, #2a2a2a 4%, #333 25%, #2a2a2a 36%);
            background-size: 1000px 100%;
        }
        .light .skeleton {
            background: linear-gradient(to right, #e5e7eb 4%, #f3f4f6 25%, #e5e7eb 36%);
        }

        /* Line Clamp */
        .line-clamp-1 { display: -webkit-box; -webkit-line-clamp: 1; -webkit-box-orient: vertical; overflow: hidden; }
        .line-clamp-2 { display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }

        /* Player Transition */
        .player-enter { transform: translateY(100%); opacity: 0; }
        .player-active { transform: translateY(0); opacity: 1; }
        
        /* Swiper Custom Nav */
        .swiper-button-next, .swiper-button-prev {
            color: white; background: rgba(0,0,0,0.5); width: 40px; height: 100%;
            top: 22px; margin-top: 0; opacity: 0; transition: opacity 0.3s;
        }
        .group:hover .swiper-button-next, .group:hover .swiper-button-prev { opacity: 1; }
        .swiper-button-disabled { opacity: 0 !important; }
        .swiper-button-next::after, .swiper-button-prev::after { font-size: 20px; font-weight: bold; }

        /* Custom Selectors */
        .glass-nav { background: rgba(20, 20, 20, 0.9); backdrop-filter: blur(10px); }
        .light .glass-nav { background: rgba(255, 255, 255, 0.9); }
    </style>
</head>
<body class="bg-gray-100 text-gray-900 dark:bg-darker dark:text-gray-100 transition-colors duration-300 overflow-x-hidden">

    <!-- Navbar -->
    <nav class="fixed top-0 w-full z-40 glass-nav border-b border-gray-200 dark:border-gray-800 transition-colors duration-300">
        <div class="max-w-[1800px] mx-auto px-4 h-16 flex items-center justify-between gap-4">
            <!-- Logo -->
            <a href="#" onclick="app.goHome()" class="flex items-center gap-2 flex-shrink-0">
                <i class="ph-fill ph-television-simple text-brand text-3xl"></i>
                <span class="font-bold text-xl tracking-tight hidden sm:block">Bongo<span class="text-brand">Stream</span></span>
            </a>

            <!-- Search -->
            <div class="flex-1 max-w-xl relative">
                <div class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400">
                    <i class="ph ph-magnifying-glass text-lg"></i>
                </div>
                <input type="text" id="searchInput" placeholder="Search serials, episodes..." 
                    class="w-full bg-gray-200 dark:bg-black/50 border border-transparent focus:border-brand rounded-full py-2 pl-10 pr-4 outline-none transition-all text-sm placeholder-gray-500 text-gray-900 dark:text-white">
            </div>

            <!-- Actions -->
            <div class="flex items-center gap-3 sm:gap-5">
                <div id="lastUpdated" class="hidden md:block text-xs text-gray-500 font-mono"></div>
                <button id="themeToggle" class="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-800 transition-colors">
                    <i class="ph-fill ph-moon text-xl dark:hidden"></i>
                    <i class="ph-fill ph-sun text-xl hidden dark:block text-yellow-400"></i>
                </button>
                <div class="w-8 h-8 rounded bg-gradient-to-br from-brand to-purple-600 flex items-center justify-center text-xs font-bold text-white cursor-pointer">
                    BS
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Container -->
    <main id="mainContainer" class="pt-16 min-h-screen pb-20">
        <!-- Loading State -->
        <div id="globalLoader" class="flex flex-col items-center justify-center h-[80vh]">
            <div class="w-12 h-12 border-4 border-brand border-t-transparent rounded-full animate-spin mb-4"></div>
            <p class="text-gray-500 animate-pulse">Loading library...</p>
        </div>

        <!-- Content Wrapper -->
        <div id="contentArea" class="hidden opacity-0 transition-opacity duration-500">
            
            <!-- Hero Section -->
            <div class="relative w-full h-[50vh] md:h-[70vh] mb-8 group">
                <div class="swiper hero-swiper w-full h-full">
                    <div class="swiper-wrapper" id="heroWrapper">
                        <!-- Hero Slides Injected Here -->
                    </div>
                    <div class="swiper-pagination"></div>
                </div>
            </div>

            <!-- Lists Container -->
            <div class="max-w-[1800px] mx-auto px-4 space-y-8" id="rowsContainer">
                <!-- Dynamic Rows Injected Here -->
            </div>

             <!-- Search Results Container (Hidden by default) -->
             <div id="searchResults" class="hidden max-w-[1800px] mx-auto px-4 pt-6">
                <h2 class="text-xl font-bold mb-4 flex items-center gap-2">
                    <i class="ph ph-magnifying-glass"></i> Search Results
                    <span id="searchCount" class="text-sm font-normal text-gray-500"></span>
                </h2>
                <div id="searchGrid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4"></div>
             </div>
        </div>
    </main>

    <!-- Player Overlay (Fixed Fullscreen/Modal) -->
    <div id="playerModal" class="fixed inset-0 z-50 bg-black transition-transform duration-300 translate-y-[100%] flex flex-col">
        <!-- Player Header -->
        <div class="flex items-center justify-between px-4 py-3 bg-gradient-to-b from-black/80 to-transparent absolute top-0 left-0 right-0 z-10">
            <button onclick="app.closePlayer()" class="flex items-center gap-2 text-white hover:text-brand transition-colors bg-black/20 backdrop-blur-md px-4 py-2 rounded-full">
                <i class="ph-bold ph-arrow-left"></i> <span class="text-sm font-medium">Back to Browse</span>
            </button>
        </div>

        <!-- Video Container -->
        <div class="relative flex-1 bg-black flex items-center justify-center overflow-hidden group">
            <div class="w-full h-full max-w-[1600px] max-h-full flex items-center justify-center">
                <video-js id="mainPlayer" class="vjs-big-play-centered vjs-theme-netflix" controls preload="auto" style="width: 100%; height: 100%; max-height: 85vh;"></video-js>
            </div>
        </div>

        <!-- Info & Recommendations -->
        <div class="h-[35vh] md:h-[30vh] bg-darker border-t border-gray-800 overflow-y-auto p-4 md:p-6">
            <div class="max-w-[1600px] mx-auto grid grid-cols-1 lg:grid-cols-3 gap-8">
                <!-- Meta -->
                <div class="lg:col-span-1 space-y-2">
                    <div class="flex items-center gap-2 text-brand text-xs font-bold uppercase tracking-wider">
                        <span id="playerGroup">Group</span>
                        <span class="w-1 h-1 rounded-full bg-gray-500"></span>
                        <span id="playerDate">Date</span>
                    </div>
                    <h1 id="playerTitle" class="text-2xl md:text-3xl font-bold text-white leading-tight">Title</h1>
                    <p class="text-gray-400 text-sm line-clamp-3" id="playerDesc">Enjoy streaming this episode in high quality.</p>
                </div>
                
                <!-- Up Next / Related -->
                <div class="lg:col-span-2">
                    <h3 class="text-sm font-bold text-gray-400 mb-3 uppercase tracking-wider">More from this serial</h3>
                    <div class="flex gap-4 overflow-x-auto no-scrollbar pb-2" id="relatedRow">
                        <!-- Related items injected -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Libraries -->
    <script src="https://vjs.zencdn.net/8.6.1/video.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>

    <!-- App Logic -->
    <script>
        const CONFIG = {
            M3U_URL: 'https://raw.githubusercontent.com/piyashltd/m3ubot/refs/heads/main/serial.m3u',
            CACHE_KEY: 'bongo_data_v1',
            CACHE_TIME_KEY: 'bongo_time_v1',
            CACHE_DURATION: 12 * 60 * 60 * 1000, // 12 hours
        };

        const app = {
            data: [],
            groups: {},
            player: null,
            isDark: true,
            
            init: async () => {
                app.initTheme();
                app.initSearch();
                
                const cachedData = localStorage.getItem(CONFIG.CACHE_KEY);
                const cachedTime = localStorage.getItem(CONFIG.CACHE_TIME_KEY);
                const now = Date.now();

                if (cachedData && cachedTime && (now - parseInt(cachedTime) < CONFIG.CACHE_DURATION)) {
                    console.log('Loading from cache...');
                    app.processData(JSON.parse(cachedData), parseInt(cachedTime));
                } else {
                    console.log('Fetching fresh data...');
                    await app.fetchAndParse();
                }
            },

            initTheme: () => {
                const savedTheme = localStorage.getItem('theme');
                app.isDark = savedTheme === 'light' ? false : true;
                app.applyTheme();
                document.getElementById('themeToggle').addEventListener('click', () => {
                    app.isDark = !app.isDark;
                    localStorage.setItem('theme', app.isDark ? 'dark' : 'light');
                    app.applyTheme();
                });
            },

            applyTheme: () => {
                const html = document.documentElement;
                if (app.isDark) html.classList.add('dark');
                else html.classList.remove('dark');
            },

            fetchAndParse: async () => {
                try {
                    const response = await fetch(CONFIG.M3U_URL);
                    if (!response.ok) throw new Error('Network response was not ok');
                    const text = await response.text();
                    const parsed = app.parseM3U(text);
                    
                    localStorage.setItem(CONFIG.CACHE_KEY, JSON.stringify(parsed));
                    localStorage.setItem(CONFIG.CACHE_TIME_KEY, Date.now().toString());
                    
                    app.processData(parsed, Date.now());
                } catch (error) {
                    console.error('Fetch error:', error);
                    document.getElementById('globalLoader').innerHTML = `<p class="text-red-500">Failed to load content. Please refresh.</p>`;
                }
            },

            parseM3U: (content) => {
                const lines = content.split('\n');
                const items = [];
                let currentItem = null;

                const monthNames = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];

                for (let line of lines) {
                    line = line.trim();
                    if (line.startsWith('#EXTINF:')) {
                        const info = line.substring(8);
                        const attributes = {};
                        
                        // Extract attributes crudely but effectively
                        const groupMatch = info.match(/group-title="([^"]*)"/);
                        const logoMatch = info.match(/tvg-logo="([^"]*)"/);
                        
                        const titlePart = info.split(',')[1] || 'Unknown Title';
                        
                        currentItem = {
                            id: Math.random().toString(36).substr(2, 9),
                            title: titlePart.trim(),
                            group: groupMatch ? groupMatch[1] : 'Unknown',
                            thumb: logoMatch ? logoMatch[1] : 'https://via.placeholder.com/300x169?text=No+Image',
                            rawDate: null,
                            formattedDate: '',
                            episodeNumber: null
                        };

                        // Date Parsing (YYYY-MM-DD)
                        const dateMatch = currentItem.title.match(/(\d{4}-\d{2}-\d{2})/);
                        if (dateMatch) {
                            currentItem.rawDate = dateMatch[1];
                            const d = new Date(dateMatch[1]);
                            if (!isNaN(d)) {
                                currentItem.formattedDate = `${d.getDate()} ${monthNames[d.getMonth()]} ${d.getFullYear()}`;
                            }
                        }

                        // Episode Parsing
                        const epMatch = currentItem.title.match(/Episode\s+(\d+)/i);
                        if (epMatch) {
                            currentItem.episodeNumber = parseInt(epMatch[1]);
                        }

                    } else if (line.startsWith('http') && currentItem) {
                        currentItem.streamUrl = line;
                        items.push(currentItem);
                        currentItem = null;
                    }
                }
                return items;
            },

            processData: (data, timestamp) => {
                // Sort by rawDate Descending globally first
                app.data = data.sort((a, b) => {
                    const da = a.rawDate ? new Date(a.rawDate) : new Date(0);
                    const db = b.rawDate ? new Date(b.rawDate) : new Date(0);
                    return db - da;
                });

                // Grouping
                app.groups = {};
                app.data.forEach(item => {
                    if (!app.groups[item.group]) app.groups[item.group] = [];
                    app.groups[item.group].push(item);
                });

                // Sort inside groups (Episode desc, then date desc)
                Object.keys(app.groups).forEach(key => {
                    app.groups[key].sort((a, b) => {
                        if (a.episodeNumber && b.episodeNumber) return b.episodeNumber - a.episodeNumber;
                        const da = a.rawDate ? new Date(a.rawDate) : new Date(0);
                        const db = b.rawDate ? new Date(b.rawDate) : new Date(0);
                        return db - da;
                    });
                });

                // UI Update
                const dateObj = new Date(timestamp);
                document.getElementById('lastUpdated').innerText = `Updated: ${dateObj.toLocaleTimeString()} ${dateObj.toLocaleDateString()}`;
                
                app.render();
            },

            render: () => {
                const loader = document.getElementById('globalLoader');
                const content = document.getElementById('contentArea');
                
                loader.classList.add('hidden');
                content.classList.remove('hidden');
                setTimeout(() => content.classList.remove('opacity-0'), 50);

                app.renderHero();
                app.renderRows();
            },

            renderHero: () => {
                const wrapper = document.getElementById('heroWrapper');
                // Top 4 latest items
                const heroItems = app.data.slice(0, 4);
                
                wrapper.innerHTML = heroItems.map(item => `
                    <div class="swiper-slide relative w-full h-full bg-darker overflow-hidden cursor-pointer" onclick="app.openPlayer('${item.id}')">
                        <img src="${item.thumb}" class="absolute inset-0 w-full h-full object-cover opacity-60 transition-transform duration-1000 hover:scale-105" 
                             onerror="this.src='https://via.placeholder.com/800x450?text=Preview+Unavailable'">
                        <div class="absolute inset-0 bg-gradient-to-t from-darker via-darker/50 to-transparent"></div>
                        <div class="absolute bottom-0 left-0 w-full p-6 md:p-12 max-w-4xl">
                            <span class="inline-block px-2 py-1 mb-3 text-xs font-bold bg-brand text-white rounded uppercase tracking-wider">New Episode</span>
                            <h2 class="text-3xl md:text-5xl font-bold text-white mb-2 drop-shadow-lg line-clamp-2">${item.title}</h2>
                            <div class="flex items-center gap-4 text-gray-300 text-sm font-medium">
                                <span>${item.group}</span>
                                <span>â€¢</span>
                                <span>${item.formattedDate || 'Recently Added'}</span>
                            </div>
                            <div class="mt-6 flex gap-4">
                                <button class="px-6 py-2.5 bg-white text-black hover:bg-gray-200 font-bold rounded flex items-center gap-2 transition-colors">
                                    <i class="ph-fill ph-play"></i> Watch Now
                                </button>
                            </div>
                        </div>
                    </div>
                `).join('');

                new Swiper('.hero-swiper', {
                    loop: true,
                    autoplay: { delay: 5000, disableOnInteraction: false },
                    pagination: { el: '.swiper-pagination', clickable: true },
                    effect: 'fade',
                    fadeEffect: { crossFade: true }
                });
            },

            renderRows: () => {
                const container = document.getElementById('rowsContainer');
                container.innerHTML = '';

                // 1. Latest Episodes Row
                app.createRow(container, 'Latest Episodes', app.data.slice(0, 15));

                // 2. Top Groups (by count)
                const sortedGroups = Object.entries(app.groups)
                    .sort((a, b) => b[1].length - a[1].length)
                    .slice(0, 5); // Top 5 groups

                sortedGroups.forEach(([groupName, items]) => {
                    if (items.length > 0) {
                        app.createRow(container, groupName, items.slice(0, 15)); // Limit 15 per row
                    }
                });
            },

            createRow: (container, title, items) => {
                const rowId = 'swiper-' + Math.random().toString(36).substr(2, 9);
                
                const section = document.createElement('section');
                section.className = 'group relative';
                section.innerHTML = `
                    <h3 class="text-lg md:text-xl font-bold mb-3 text-gray-800 dark:text-gray-100 px-1 flex items-center gap-2">
                        ${title} <i class="ph-bold ph-caret-right text-xs text-gray-500 mt-1"></i>
                    </h3>
                    <div class="swiper ${rowId} overflow-visible">
                        <div class="swiper-wrapper pb-8">
                            ${items.map(item => app.createCard(item)).join('')}
                        </div>
                        <div class="swiper-button-prev -left-4 md:-left-8 rounded-r-md"></div>
                        <div class="swiper-button-next -right-4 md:-right-8 rounded-l-md"></div>
                    </div>
                `;
                
                container.appendChild(section);

                new Swiper('.' + rowId, {
                    slidesPerView: 2,
                    spaceBetween: 10,
                    slidesPerGroup: 2,
                    lazy: true,
                    navigation: {
                        nextEl: section.querySelector('.swiper-button-next'),
                        prevEl: section.querySelector('.swiper-button-prev'),
                    },
                    breakpoints: {
                        640: { slidesPerView: 3, spaceBetween: 12, slidesPerGroup: 3 },
                        768: { slidesPerView: 4, spaceBetween: 12, slidesPerGroup: 4 },
                        1024: { slidesPerView: 5, spaceBetween: 16, slidesPerGroup: 5 },
                        1280: { slidesPerView: 6, spaceBetween: 16, slidesPerGroup: 6 }
                    }
                });
            },

            createCard: (item) => {
                return `
                    <div class="swiper-slide transition-transform duration-300 hover:z-10 hover:scale-105 origin-center" onclick="app.openPlayer('${item.id}')">
                        <div class="bg-white dark:bg-card rounded-md overflow-hidden shadow-sm hover:shadow-xl cursor-pointer h-full flex flex-col">
                            <div class="aspect-video relative bg-gray-800 overflow-hidden">
                                <img data-src="${item.thumb}" class="swiper-lazy w-full h-full object-cover" alt="${item.title}" 
                                     onerror="this.src='https://via.placeholder.com/300x169?text=No+Image'">
                                <div class="swiper-lazy-preloader swiper-lazy-preloader-white"></div>
                                ${item.episodeNumber ? `<div class="absolute top-2 right-2 bg-black/60 backdrop-blur-sm text-white text-[10px] font-bold px-1.5 py-0.5 rounded">EP ${item.episodeNumber}</div>` : ''}
                                <div class="absolute inset-0 bg-black/20 hover:bg-transparent transition-colors"></div>
                                <div class="absolute inset-0 flex items-center justify-center opacity-0 hover:opacity-100 transition-opacity duration-300">
                                    <div class="w-10 h-10 bg-brand/90 rounded-full flex items-center justify-center shadow-lg">
                                        <i class="ph-fill ph-play text-white"></i>
                                    </div>
                                </div>
                            </div>
                            <div class="p-3 flex flex-col flex-grow justify-between">
                                <div>
                                    <h4 class="text-sm font-semibold leading-tight line-clamp-2 text-gray-900 dark:text-white mb-1" title="${item.title}">${item.title.replace(item.group, '').replace(/^[-: ]+/, '')}</h4>
                                    <p class="text-xs text-gray-500 dark:text-gray-400 line-clamp-1">${item.group}</p>
                                </div>
                                <p class="text-[10px] text-gray-400 mt-2 font-mono text-right">${item.formattedDate || ''}</p>
                            </div>
                        </div>
                    </div>
                `;
            },

            initSearch: () => {
                const input = document.getElementById('searchInput');
                input.addEventListener('input', (e) => {
                    const query = e.target.value.toLowerCase();
                    const rows = document.getElementById('rowsContainer');
                    const hero = document.querySelector('.hero-swiper').parentElement;
                    const resultsDiv = document.getElementById('searchResults');
                    const grid = document.getElementById('searchGrid');

                    if (query.length < 2) {
                        rows.style.display = 'block';
                        hero.style.display = 'block';
                        resultsDiv.classList.add('hidden');
                        return;
                    }

                    rows.style.display = 'none';
                    hero.style.display = 'none';
                    resultsDiv.classList.remove('hidden');

                    const matches = app.data.filter(item => 
                        item.title.toLowerCase().includes(query) || 
                        item.group.toLowerCase().includes(query)
                    );

                    document.getElementById('searchCount').innerText = `Found ${matches.length} episodes`;
                    
                    if (matches.length === 0) {
                        grid.innerHTML = `<div class="col-span-full text-center text-gray-500 py-10">No results found for "${query}"</div>`;
                    } else {
                        grid.innerHTML = matches.map(item => `
                            <div class="cursor-pointer group" onclick="app.openPlayer('${item.id}')">
                                <div class="aspect-video relative rounded overflow-hidden mb-2 bg-gray-800">
                                    <img src="${item.thumb}" class="w-full h-full object-cover opacity-80 group-hover:opacity-100 transition-opacity" loading="lazy">
                                    <div class="absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100">
                                        <i class="ph-fill ph-play-circle text-4xl text-white drop-shadow-lg"></i>
                                    </div>
                                </div>
                                <h4 class="text-sm font-bold text-gray-900 dark:text-white line-clamp-1">${item.title}</h4>
                                <p class="text-xs text-gray-500">${item.formattedDate || item.group}</p>
                            </div>
                        `).join('');
                    }
                });
            },

            openPlayer: (id) => {
                const item = app.data.find(i => i.id === id);
                if (!item) return;

                const modal = document.getElementById('playerModal');
                
                // Init Player if first time
                if (!app.player) {
                    app.player = videojs('mainPlayer', {
                        fluid: true,
                        html5: {
                            hls: {
                                enableLowInitialPlaylist: true,
                                smoothQualityChange: true,
                                overrideNative: true,
                            },
                        },
                    });
                }

                app.player.src({
                    src: item.streamUrl,
                    type: 'application/x-mpegURL' // HLS standard
                });

                // Update Meta
                document.getElementById('playerTitle').innerText = item.title;
                document.getElementById('playerGroup').innerText = item.group;
                document.getElementById('playerDate').innerText = item.formattedDate || 'Unknown Date';
                document.getElementById('playerDesc').innerText = `${item.group} - ${item.title}. Stream now in HD.`;

                // Related
                const related = app.groups[item.group]
                    .filter(i => i.id !== id)
                    .slice(0, 10); // Top 10 related

                const relatedContainer = document.getElementById('relatedRow');
                relatedContainer.innerHTML = related.map(r => `
                    <div class="min-w-[200px] w-[200px] cursor-pointer group" onclick="app.switchEpisode('${r.id}')">
                        <div class="aspect-video relative rounded overflow-hidden mb-2 bg-gray-800">
                            <img src="${r.thumb}" class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500" loading="lazy" onerror="this.src='https://via.placeholder.com/200x112'">
                            <div class="absolute bottom-1 right-1 bg-black/70 text-white text-[9px] px-1 rounded">
                                ${r.episodeNumber ? 'EP '+r.episodeNumber : ''}
                            </div>
                        </div>
                        <h5 class="text-xs font-bold text-gray-300 group-hover:text-white line-clamp-1">${r.title}</h5>
                        <p class="text-[10px] text-gray-500">${r.formattedDate}</p>
                    </div>
                `).join('');

                modal.classList.remove('translate-y-[100%]');
                setTimeout(() => app.player.play().catch(e => console.log("Auto-play prevented")), 500);
            },

            switchEpisode: (id) => {
                // Quick switch without closing modal
                app.openPlayer(id);
            },

            closePlayer: () => {
                if (app.player) app.player.pause();
                document.getElementById('playerModal').classList.add('translate-y-[100%]');
            },
            
            goHome: () => {
                document.getElementById('searchInput').value = '';
                document.getElementById('searchInput').dispatchEvent(new Event('input'));
                app.closePlayer();
            }
        };

        // Keyboard navigation for accessibility
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') app.closePlayer();
        });

        // Start
        document.addEventListener('DOMContentLoaded', app.init);

    </script>
</body>
</html>

